% \LaTeX beamer theme with CSCS style layout
% author: Maxime Martinasso <maxime.martinasso@cscs.ch>
% April, 21st, 2015

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{beamerthemeCSCS}[2015/04/21 CSCS beamer theme]
\RequirePackage{ifthen}
\RequirePackage[scaled=.85]{helvet}
\RequirePackage{tcolorbox}
\RequirePackage{listings}
\tcbuselibrary{listings,skins}


\newlength{\@headerdist}
\setlength{\@headerdist}{5mm}

\mode<presentation>

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CSCS color definition
\definecolor{cscsred}{RGB}{172,27,38}
\definecolor{cscsgrey}{RGB}{64,64,64}
\definecolor{cscsgreen}{RGB}{114,121,28}
\definecolor{cscsblue}{RGB}{0,122,150}
\definecolor{cscsbrown}{RGB}{151,72,6}
\definecolor{cscspurple}{RGB}{128,0,128}
\definecolor{cscsyellow}{RGB}{167,135,32}
\definecolor{cscsblack}{RGB}{0,0,0}
\definecolor{cscswhite}{RGB}{255,255,255}


% no navigation
\setbeamertemplate{navigation symbols}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Block definitions

\tcbset{arc=0mm,boxrule=0.2mm}

\newenvironment<>{black0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=black,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{black1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=black,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{black2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=black,colbacktitle=white!75!black,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{green0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsgreen,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{green1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsgreen,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{green2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsgreen,colbacktitle=cscsgreen!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{blue0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsblue,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{blue1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsblue,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{blue2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsblue,colbacktitle=cscsblue!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{brown0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsbrown,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{brown1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsbrown,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{brown2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsbrown,colbacktitle=cscsbrown!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{purple0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscspurple,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{purple1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscspurple,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{purple2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscspurple,colbacktitle=cscspurple!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{yellow0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsyellow,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{yellow1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsyellow,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{yellow2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsyellow,colbacktitle=cscsyellow!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}

\newenvironment<>{red0block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsred,colbacktitle=white,coltitle=black,title=#1]}{\end{tcolorbox}}
\newenvironment<>{red1block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsred,coltitle=white,title=#1]}{\end{tcolorbox}}
\newenvironment<>{red2block}[1]{%
\setbeamercolor{block title}{}%
\begin{tcolorbox}[colback=white,colframe=cscsred,colbacktitle=cscsred!50!white,coltitle=black,title=#1]}{\end{tcolorbox}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Title frame
\setbeamertemplate{background canvas}{%
\ifnum\c@framenumber=1%First slide
\begin{picture}(0,40)
      \put(12,2){\includegraphics[scale=.25]{cscs_images/image4.pdf}}
      \put(312,14){\includegraphics[scale=.28]{cscs_images/image1.pdf}}
  \end{picture}
  \begin{picture}(0,0)
      \put(-2.5,-100){\includegraphics[width=\paperwidth]{\picturetitle}}
      \put(-2.5,-101){\color{cscsred}\rule{\paperwidth}{0.4mm}}
  \end{picture}
\fi%
}

\setbeamertemplate{frametitle}
{
  \ifbeamer@plainframe
  \else
    \vspace{.5cm}\hspace{-.5cm}
    \textbf{\color{cscsgrey}\insertframetitle}
    \vspace{-.2cm}
  \fi
}

% title page with CSCS image
\setbeamertemplate{title page}{
  \vspace{\@headerdist}
  \vspace{4.5cm}
  \hspace{-6.5mm}
  \textbf{\LARGE{\color{cscsgrey}\inserttitle}}\\[2mm]
  \normalsize
  \hspace{-6.5mm}
  {\color{gray}\insertsubtitle}\\
  \hspace{-6.5mm}
  {\color{gray}\insertauthor}\\
  \hspace{-6.5mm}
  {\color{gray}\insertdate}
}

\newcommand{\cscstitle}{
\begin{frame}[plain]
\titlepage
\end{frame}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Chapter title frame
\newcommand{\cscschapter}[1]{
\begin{frame}[plain]
\begin{picture}(0,0)
   \put(-16,71){\includegraphics[scale=.25]{cscs_images/image4.pdf}}
   \put(285,83){\includegraphics[scale=.29]{cscs_images/image1.pdf}}
\end{picture}
\begin{picture}(0,0)
   \put(-18,-22){\usebeamerfont{part title}\color{cscsgrey}\textbf{#1}}
   \put(-31,-28){\color{cscsred}\rule{\paperwidth}{0.4mm}}
\end{picture}
\end{frame}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Table of content frame
\setbeamercolor{section in toc}{fg=black}
\setbeamertemplate{section in toc}{
  \leavevmode
  \llap{%
      \makebox(5,5)[t]{
          \textcolor{cscsred}{\vrule width1mm height1mm depth.1mm}
      }
   }%
   \hspace{2mm}\inserttocsection\par
}
\setbeamertemplate{subsection in toc}{
  \leavevmode\leftskip=4ex%
  \llap{%
      \makebox(5,5)[t]{
          \textcolor{cscsgrey}{\vrule width1.5mm height0.2mm depth.1mm}
      }
   }%
   \hspace{2mm}\inserttocsubsection\par
}
\setbeamertemplate{subsubsection in toc}{
  \leavevmode\leftskip=9ex%
  \llap{%
      \makebox(5,5)[t]{
          \textcolor{black}{\tiny$\bullet$}
      }
   }%
   \hspace{2mm}\inserttocsubsubsection\par
}

\newcommand{\cscstableofcontents}[2][]{
\begin{frame}
\frametitle{#2}
\begin{columns}[T]
\begin{column}{.5\textwidth}
\includegraphics[width=157px, height=203px]{cscs_images/image8.jpeg}
\end{column}
\begin{column}{.5\textwidth}
\vspace{.2cm}
\tableofcontents[#1]
\end{column}
\end{columns}
\end{frame}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Footer with configurable text
\setbeamercolor{footline}{fg=gray}
\setbeamertemplate{footline}{
  \ifbeamer@plainframe
  \else
  \begin{picture}(0,0)
      \put(14,7){\includegraphics[scale=.14]{cscs_images/image2.pdf}}
      \put(158,11){{\fontsize{4.5}{5}\selectfont \footlinetext {\fontsize{6}{7}\selectfont\color{black}$\;\mid\,$} \color{gray}\insertframenumber}}
      \put(319,10){\includegraphics[scale=.22]{cscs_images/image1.pdf}}
  \end{picture}
  \fi
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Thank you frame
\newcommand{\cscsthankyou}[1]{
    \begin{frame}[noframenumbering,plain]
\begin{picture}(0,0)
   \put(-16,71){\includegraphics[scale=.25]{cscs_images/image4.pdf}}
   \put(285,83){\includegraphics[scale=.29]{cscs_images/image1.pdf}}
\end{picture}
\begin{picture}(0,0)
   \put(-31,-26){\includegraphics[width=\paperwidth]{cscs_images/image7.pdf}}
   \put(-31,-27){\color{cscsred}\rule{\paperwidth}{0.4mm}}
   \put(-18,-70){\textbf{\usebeamerfont{part title}\color{cscsgrey}#1}}
\end{picture}
    \end{frame}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Change itemize and enumerate
\setbeamertemplate{itemize item}{\makebox(5,5)[t]{\textcolor{cscsred}{\vrule width1mm height1mm depth.1mm}}}
\setbeamertemplate{itemize subitem}{\makebox(5,5)[t]{\textcolor{cscsgrey}{\vrule width1.5mm height0.2mm depth.1mm}}}
\setbeamertemplate{itemize subsubitem}{\makebox(5,5)[t]{\textcolor{black}{\tiny$\bullet$}}}

\setbeamertemplate{enumerate item}{\textcolor{cscsgrey}{\insertenumlabel.}}
\setbeamertemplate{enumerate subitem}{\textcolor{cscsgrey}{\insertenumlabel.\insertsubenumlabel}}
\setbeamertemplate{enumerate subsubitem}{\textcolor{cscsgrey}{\insertenumlabel.\insertsubenumlabel.\insertsubsubenumlabel}}
\setbeamertemplate{enumerate mini template}{\textcolor{cscsgrey}{\insertenumlabel}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Code listing
\newcommand{\lstfont}[1]{\color{#1}\scriptsize\ttfamily}
\newcommand{\lsttinyfont}[1]{\color{#1}\fontsize{7}{7}\ttfamily}
\newcommand{\lstinlinefont}[1]{\color{#1}\scriptsize\ttfamily}

\lstdefinestyle{CppStyle}{
language=[ANSI]C++,
showstringspaces=false,
backgroundcolor=\color{cscswhite!10!cscsblack},
basicstyle=\lstfont{cscsblue!60!cscswhite},
identifierstyle=\lstfont{cscswhite},
keywordstyle=\lstfont{magenta!40!cscswhite},
numberstyle=\lstfont{cscswhite},
stringstyle=\lstfont{cyan},
commentstyle=\lstfont{cscsyellow!80!cscswhite},
moredelim=[is][\lstfont{cscsgreen!60!cscswhite}]{@}{@},
emph={
        pragma, omp, shared, private, reduction,
        omp_get_wtime, omp_get_max_threads, omp_get_thread_num
},
emphstyle={\lstfont{cscsgreen!60!cscswhite}},
breaklines=true
}

\newtcblisting{Cpplisting}[2][]{
colback=cscsblack,
colframe=cscsblack,
colbacktitle=cscswhite!75!cscsblack,
coltitle=cscsblack,
arc=0pt, outer arc=0pt,
leftrule=0pt, rightrule=0pt, toprule=0pt, bottomrule=0pt, titlerule=0pt,
boxsep=0pt,
left=0pt, right=0pt, top=-6pt, bottom=-6pt, bottomtitle=0pt, toptitle=0pt,
listing only,
listing style=CppStyle,
adjusted title=\lsttinyfont{cscsblack}{C/C++ #1},
#2
}

\newcommand{\lstinlineCpp}[1]{\colorbox{cscswhite!20!cscsblack}{\lstinline[style=CppStyle]!#1!}}

\lstdefinestyle{FortranStyle}{
language=[90]Fortran,
showstringspaces=false,
backgroundcolor=\color{cscswhite!10!cscsblack},
basicstyle=\lstfont{cscsblue!60!cscswhite},
identifierstyle=\lstfont{cscswhite},
keywordstyle=\lstfont{magenta!40!cscswhite},
numberstyle=\lstfont{cscswhite},
stringstyle=\lstfont{cyan},
commentstyle=\lstfont{cscsyellow!30!cscswhite},
moredelim=[is][\lstfont{cscsgreen!60!cscswhite}]{@}{@},
emph={
        pragma, omp, shared, private, reduction,
        omp_get_wtime, omp_get_max_threads, omp_get_thread_num
},
emphstyle={\lstfont{cscsgreen!60!cscswhite}},
breaklines=true
}

\newtcblisting{Fortranlisting}[2][]{
colback=cscsblack,
colframe=cscsblack,
colbacktitle=cscswhite!75!cscsblack,
coltitle=cscsblack,
arc=0pt, outer arc=0pt,
leftrule=0pt, rightrule=0pt, toprule=0pt, bottomrule=0pt, titlerule=0pt,
boxsep=0pt,
left=0pt, right=0pt, top=-6pt, bottom=-6pt, bottomtitle=0pt, toptitle=0pt,
listing only,
listing style=FortranStyle,
adjusted title=\lsttinyfont{cscsblack}{Fortran #1},
#2
}

\newcommand{\lstinlineFortran}[1]{\colorbox{cscswhite!20!cscsblack}{\lstinline[style=FortranStyle]!#1!}}
\mode
<all>
